<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta http-equiv="imagetoolbar" content="false" />
  <meta name="MSSmartTagsPreventParsing" content="true" />
  <title>Lifely API guide | RoQua Developer Docs</title>
  <link href="/developer/assets/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/developer/assets/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/developer/assets/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/developer/assets/css/documentation.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/developer/assets/css/pygments.css" media="screen" rel="stylesheet" type="text/css">
  <link href="//cdnjs.cloudflare.com/ajax/libs/octicons/2.1.2/octicons.min.css" media="screen" rel="stylesheet" type="text/css">
  <script src="/developer/assets/js/jquery.js" type="text/javascript"></script>
  <script src="/developer/assets/js/documentation.js" type="text/javascript"></script>
  <link href="/assets/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">
</head>





<body class="rom">
  <div id="header-wrapper">
  <div id="header">
    <div>
      <a class="logo" href="/developer/">RoQua Developer</a>
      <ul class="nav">
        <li class="home"><a href="/developer/">Overview</a></li>
        <li><a href="/developer/core/">Core</a></li>
        <li><a href="/developer/rom/">ROM</a></li>
        <li><a href="/developer/quby/">Quby</a></li>
        <li><a href="http://roqua.nl/contact">Support</a></li>
      </ul>
    </div>
  </div><!-- #header -->
</div><!-- #header-wrapper -->


  <div class="sub-nav">
    <h2>
      <strong>Guides</strong>
      : Lifely API guide
      <span class="status status-draft">
          draft
          </span>
    </h2>
  </div>

  <div id="wrapper">
    <div class="content">
      <ul id="markdown-toc">
<li><a href="#configuratie">Configuratie</a></li>
  <li><a href="#stap-1-dossier-aanmaken">Stap 1: dossier aanmaken</a></li>
  <li><a href="#stap-2a-protocol-subscription-starten">Stap 2a: protocol subscription starten</a></li>
  <li><a href="#stap-2b-protocol-subscription-stoppen">Stap 2b: protocol subscription stoppen</a></li>
  <li><a href="#stap-3-ingevulde-data-terugsturen">Stap 3: Ingevulde data terugsturen</a></li>
  <li><a href="#stap-3a-gemiste-data-melden">Stap 3a: Gemiste data melden</a></li>
  <li><a href="#stap-4-resultaten-berekenen-en-ophalen">Stap 4: Resultaten berekenen en ophalen</a></li>
  <li><a href="#af-en-toe-vragenlijst-definitie-ophalen">Af en toe: Vragenlijst-definitie ophalen</a></li>
</ul><h2 id="configuratie">Configuratie</h2>

<pre><code>ROQUA_CORE_API_USERNAME
ROQUA_CORE_API_PASSWORD
ROQUA_ROM_API_USERNAME
ROQUA_ROM_API_PASSWORD
ROQUA_DOSSIER_GROUP_ID
</code></pre>

<h2 id="stap-1-dossier-aanmaken">Stap 1: dossier aanmaken</h2>

<p>Als eerste stap wordt bij aanmelding een call gedaan om een dossier te openen. Hierbij wordt het ROQUA_DOSSIER_ID die ontvangen is van het Espria Ledenpanel doorgestuurd zodat dit later te koppelen is.</p>

<p><a href="/developer/core/dossier/dossiers/">Full API Docs</a></p>

<h3 id="request">Request</h3>

<pre><code>POST https://core.roqua.nl/api/v1/dossier_groups/ROQUA_DOSSIER_GROUP_ID/dossiers
{
  "dossier": {
    "external_identifier": "ESPRIA_ID"
  },
  "person": {
    "birthdate": "1980-02-23",
    "email": "jan@gmail.com",
    "zipcode": "1602",
    "gender": "M"
  }
}
</code></pre>

<p>Als er een dossier id bestaat voor het opgevraagde espria id update Lifely alleen de birthdate, zipcode en gender. Als het dossier id nog niet bestaat sturen ze alles op wat ze van ledenpanel krijgen: firstname, lastname, initials, email, birthdate, zipcode, gender.</p>

<h3 id="response">Response</h3>

<pre class="headers"><code>Status: 200 OK</code></pre>

<pre><code class="language-javascript"><span class="p">{</span>
  <span class="s2">"id"</span><span class="o">:</span> <span class="s2">"59abe42d-ad25-4273-95ef-86444705e8d3"</span>
<span class="p">}</span></code></pre>

<h2 id="stap-2a-protocol-subscription-starten">Stap 2a: protocol subscription starten</h2>

<p>Daarna wordt er een protocol subscription gestart. Dit zorgt er voor dat er responses worden klaargezet op de volgens het protocol vastgestelde momenten. Relevante parameters hier zijn de <code>protocol_key</code> (vast gegeven) en de <code>start_at</code>. De <code>start_at</code> geeft de datum en tijd aan van de eerste ochtendmeting, als unix timestamp. In dit geval moet de tijd door Lifely worden berekend op basis van de aan de gebruiker gevraagde bedtijd.</p>

<p>RoQua geeft in de JSON terug een lijst van <code>responses</code>. Elke response heeft een <code>open_from</code> en <code>open_till</code> die aangeven wat de wenselijke timeframe is waarbinnen een gebruiker mag (beginnen met) invullen.</p>

<p><a href="/developer/rom/dossier/protocol_subscriptions/#start-a-protocol-subscription">Full API Docs</a></p>

<h3 id="a1-request">2a.1 Request</h3>

<pre><code>POST https://leefplezier.roqua.nl/api/v1/dossiers/ROQUA_DOSSIER_ID/protocol_subscriptions/
{
  "protocol_key": "leefplezier_diary",
  "start_at": 1414604287
}
</code></pre>

<h3 id="response-1">Response</h3>

<p>(Sommige extra JSON-velden weggelaten in deze guide. Geplande tijd tussen responses is fictief.)</p>

<pre class="headers"><code>Status: 200 OK</code></pre>

<pre><code class="language-javascript"><span class="p">{</span>
  <span class="s2">"id"</span><span class="o">:</span> <span class="mi">123</span><span class="p">,</span>
  <span class="s2">"responses"</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">"questionnaire_key"</span><span class="o">:</span> <span class="s2">"leefplz_db"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="o">:</span> <span class="s2">"scheduled"</span><span class="p">,</span>
      <span class="s2">"open_from"</span><span class="o">:</span> <span class="s2">"2014-11-23T09:40:20+00:00+0200"</span><span class="p">,</span>
      <span class="s2">"open_till"</span><span class="o">:</span> <span class="s2">"2014-11-23T10:10:20+00:00+0200"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">"questionnaire_key"</span><span class="o">:</span> <span class="s2">"leefplz_db"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="o">:</span> <span class="s2">"scheduled"</span><span class="p">,</span>
      <span class="s2">"open_from"</span><span class="o">:</span> <span class="s2">"2014-11-23T12:40:20+00:00+0200"</span><span class="p">,</span>
      <span class="s2">"open_till"</span><span class="o">:</span> <span class="s2">"2014-11-23T13:10:20+00:00+0200"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="s2">"questionnaire_key"</span><span class="o">:</span> <span class="s2">"leefplz_db"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="o">:</span> <span class="s2">"scheduled"</span><span class="p">,</span>
      <span class="s2">"open_from"</span><span class="o">:</span> <span class="s2">"2014-11-23T21:40:20+00:00+0200"</span><span class="p">,</span>
      <span class="s2">"open_till"</span><span class="o">:</span> <span class="s2">"2014-11-23T22:10:20+00:00+0200"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="s2">"questionnaire_key"</span><span class="o">:</span> <span class="s2">"leefplz_db"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="o">:</span> <span class="s2">"scheduled"</span><span class="p">,</span>
      <span class="s2">"open_from"</span><span class="o">:</span> <span class="s2">"2014-11-24T09:40:20+00:00+0200"</span><span class="p">,</span>
      <span class="s2">"open_till"</span><span class="o">:</span> <span class="s2">"2014-11-24T10:10:20+00:00+0200"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">"questionnaire_key"</span><span class="o">:</span> <span class="s2">"leefplz_db"</span><span class="p">,</span>
      <span class="s2">"status"</span><span class="o">:</span> <span class="s2">"scheduled"</span><span class="p">,</span>
      <span class="s2">"open_from"</span><span class="o">:</span> <span class="s2">"2014-11-24T12:40:20+00:00+0200"</span><span class="p">,</span>
      <span class="s2">"open_till"</span><span class="o">:</span> <span class="s2">"2014-11-24T13:10:20+00:00+0200"</span>
    <span class="p">},</span>
    <span class="s2">"etc"</span><span class="p">,</span>
    <span class="s2">"etc"</span><span class="p">,</span>
    <span class="s2">"etc"</span>
  <span class="p">]</span>
<span class="p">}</span></code></pre>

<p>Daarnaast moet er om een protocol subscription te starten ook een call naar Leefplezier gedaan worden. Deze call hoeft alleen het <code>protocol_subscription_id</code> en het <code>dossier_id</code> te bevatten. </p>

<h3 id="a2-request">2a.2 Request</h3>

<pre><code>POST https://leefplezier.nu/api/v1/dossier/{:dossier_id}/protocol_subscriptions/{:protocol_subscription_id}/subscription
</code></pre>

<p>Deze call moet gedaan worden op het moment dat een participant zich inschrijft nadat de protocol_subscription op RoQua is gestart.</p>

<h2 id="stap-2b-protocol-subscription-stoppen">Stap 2b: protocol subscription stoppen</h2>

<p>Om de protocol subscription te stoppen moet er een delete gestuurd worden naar RoQua, met daarin het <code>roqua_dossier_id</code> en het <code>protocol_subscription_id</code> van het protocol dat gestopt moet worden.</p>

<h3 id="b1-request">2b.1 Request</h3>

<pre><code>DELETE https://leefplezier.roqua.nl/api/v1/dossiers/ROQUA_DOSSIER_ID/protocol_subscriptions/ROQUA_RESPONSE_ID
</code></pre>

<p>Daarnaast moet er om een protocol subscription te stoppen ook een call naar Leefplezier gedaan worden. Deze call hoeft alleen het <code>protocol_subscription_id</code> en het <code>dossier_id</code> te bevatten. </p>

<h3 id="b2-request">2b.2 Request</h3>

<pre><code>DELETE https://leefplezier.nu/api/v1/dossier/{:dossier_id}/protocol_subscriptions/{:protocol_subscription_id}/subscription
</code></pre>

<p>Deze call moet gedaan worden op het moment dat een participant zich uitschrijft van de studie of opnieuw begint (bij opnieuw beginnen moet ook weer de <code>POST</code> in stap 2a weer worden aangeroepen).</p>

<h2 id="stap-3-ingevulde-data-terugsturen">Stap 3: Ingevulde data terugsturen</h2>

<p>Ingevulde data die op Lifely’s servers is ontvangen kan worden teruggepost naar RoQua. Omdat deze operatie stiekem een upsert is (update OR insert if not found) moet zowel de <code>id</code> als de <code>questionnaire_key</code> van de response worden opgestuurd. De <code>questionnaire_key</code> is echter altijd <code>"leefplz_db"</code>.</p>

<p>Daarnaast wordt de <code>started_at</code> en <code>filled_out_at</code> opgestuurd. Dit zijn de Unix timestamps van de moment dat de vragenlijst getoond respectievelijk voltooid werd.</p>

<p>Onder <code>answer_data</code> worden de waarden opgestuurd.</p>

<p><a href="/developer/rom/dossier/responses/#update-a-response">Full API Docs</a></p>

<h3 id="request-1">Request</h3>

<pre><code>PUT https://leefplezier.roqua.nl/api/v1/dossiers/ROQUA_DOSSIER_ID/responses/ROQUA_RESPONSE_ID
{
    "questionnaire_key": "leefplz_db",
    "started_at": 1414604287,
    "filled_out_at": 1414604400,
    "answer_data": {"v_1" =&gt; "a1", "v_2" =&gt; 24}
}
</code></pre>

<h2 id="stap-3a-gemiste-data-melden">Stap 3a: Gemiste data melden</h2>

<p>Deze API wordt nog gemaakt door RoQua. Zal gaan lijken op de vorige, maar dan met andere parameters (iets als <code>"non_response": true</code> in plaats van <code>answer_data</code> wellicht).</p>

<p>Update: Nick zegt dat gemiste metingen niet worden opgestuurd naar RoQua. </p>

<h2 id="stap-4-resultaten-berekenen-en-ophalen">Stap 4: Resultaten berekenen en ophalen</h2>
<p>Base url = https://leefplezier.nu
Prefix = /leefplezier/api/v1</p>

<p>The API only supports GET requests and uses basic auth.</p>

<h3 id="routes">Routes</h3>

<p>POST <code>/dossier/{:dossier_id}/protocol_subscriptions/{:protocol_subscription_id}/calculate</code></p>

<ul>
<li>This route should be called by the Lifely backend after they submit the final results to RoQua, i.e., when they decide that all missing measurements are actually missing.</li>
  <li>Returns status 404 when a listresponses request to RoQua returns no diary study questionnaires for the specified user.</li>
  <li>Returns status 202 if calculate was called previously for this dossier/protocol_subscription and results are still being calculated.</li>
  <li>Otherwise it returns status 200 (note: if results were previously calculated for this dossier/protocol_subscription, calling calculate again will trigger recalculation of the results).</li>
</ul><p>GET <code>/dossier/{:dossier_id}/protocol_subscriptions/{:protocol_subscription_id}/results/welbevinden.svg</code></p>

<ul>
<li>Returns 200 status code with SVG image if the results are ready.</li>
  <li>Returns 202 if the results have not yet been calculated.</li>
  <li>Returns 204 if user has not enough measurements for feedback (&lt;25%).</li>
  <li>Returns 404 if the <code>calculate</code> route has not previously been called for this dossier_id/protocol_subscription_id. </li>
</ul><p>GET <code>/dossier/{:dossier_id}/protocol_subscriptions/{:protocol_subscription_id}/results/plezierigheid.svg</code></p>

<ul>
<li>Returns 200 status code with SVG image if the results are ready.</li>
  <li>Returns 202 if the results have not yet been calculated.</li>
  <li>Returns 204 if user has not enough measurements for feedback (&lt;25%).</li>
  <li>Returns 404 if the <code>calculate</code> route has not previously been called for this dossier_id/protocol_subscription_id.</li>
</ul><p>GET <code>/dossier/{:dossier_id}/protocol_subscriptions/{:protocol_subscription_id}/results/voorspellend_netwerk.svg</code></p>

<ul>
<li>Returns 200 status code with SVG image if the results are ready.</li>
  <li>Returns 202 if the results have not yet been calculated.</li>
  <li>Returns 204 if user has not enough measurements for a voorspellend netwerk (&lt;75%).</li>
  <li>Returns 404 if we were not able to find a network in Autovar, or if the <code>calculate</code> route has not previously been called for this dossier_id/protocol_subscription_id.</li>
</ul><p>GET <code>/dossier/{:dossier_id}/protocol_subscriptions/{:protocol_subscription_id}/results/top_networks.json</code></p>

<ul>
<li>Returns 200 status code with a JSON array if the results are ready.</li>
  <li>Returns 202 if the results have not yet been calculated.</li>
  <li>Returns 204 if user has not enough measurements for netwerk calculations (&lt;75%).</li>
  <li>Returns 404 if we were not able to find a network in Autovar, or if the <code>calculate</code> route has not previously been called for this dossier_id/protocol_subscription_id.</li>
</ul><h3 id="example-use">Example use</h3>

<p><strong>URL</strong>
<code>https://lifely_staging:api_secret@staging.leefplezier.nu/leefplezier/api/v1/dossier/123/protocol_subscriptions/abc/results/welbevinden.svg</code></p>

<p><strong>CURL</strong>
SVG example:
<code>bash
curl -X GET --user lifely_staging:api_secret https://staging.leefplezier.nu/leefplezier/api/v1/dossier/123/protocol_subscriptions/abc/results/welbevinden.svg
</code></p>

<p>JSON example:
<code>bash
curl https://lifely_staging:api_secret@staging.leefezier.nu/leefplezier/api/v1/dossier/123/protocol_subscriptions/abc/results/top_networks.json
</code></p>

<p>Returns: 
<code>json
["Meer onrust werd gevolgd door meer piekeren","Meer onrust werd gevolgd door minder concentratievermogen","Meer onrust werd gevolgd door minder opgewektheid"
</code></p>

<h2 id="af-en-toe-vragenlijst-definitie-ophalen">Af en toe: Vragenlijst-definitie ophalen</h2>

<p>Dit wordt af en toe gedaan om de vragen te syncen met onze definitie. Daarna moet telkens worden nagekeken of er geen nieuwe vraagtypes zijn opgenomen die de weergave-module van Lifely’s app niet snapt.</p>

<h3 id="request-2">Request</h3>

<pre><code>GET https://leefplezier.roqua.nl/api/v1/questionnaires/leefplz_db
</code></pre>

<h3 id="response-2">Response</h3>

<p>(Zie volledige docs)</p>

<pre class="headers"><code>Status: 200 OK</code></pre>

<pre><code class="language-javascript"><span class="p">{</span>
  <span class="s2">"questionnaire"</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">"id"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"questions"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">"v_1"</span><span class="o">:</span> <span class="p">{</span>

      <span class="p">},</span>
      <span class="s2">"v_2"</span><span class="o">:</span> <span class="p">{</span>

      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
    </div>

    <div id="js-sidebar" class="sidebar-shell">

      
        <div class="js-toggle-list sidebar-module expandable">
          <ul>
            
              <li class="js-topic">
                <h3><a href="#" class="js-expand-btn collapsed arrow-btn" data-proofer-ignore></a><a href="/developer/guides/lifely/">Lifely API guide</a></h3>
                <ul class="js-guides">
                  
                </ul>
              </li>
            
          </ul>
        </div> <!-- /sidebar-module -->
      

      <div class="sidebar-module notice">
        <p>This website is a <a href="https://github.com/roqua/developer" target="_blank">public GitHub repository</a>. Please help us by forking the project and adding to it.</p>
      </div>

    </div><!-- /sidebar-shell -->
  </div><!-- #wrapper -->

  	<div id="footer" >
    <div class="lower_footer">
      <ul class="footer-cell">
      </ul>

      <span class="footer-cell">
      </span>

      <ul class="footer-cell">
        <li><a href="http://roqua.nl/contact">Contact</a></li>
        <li><a href="https://roqua.zendesk.com">Status</a></li>
        <li><a href="https://roqua.zendesk.com/forums/20271351-Announcements">Release News</a></li>
      </ul>
    </div>

		<div class="wrapper">
			<p>Design &copy; <span class="js-year">2014</span> RoQua. All rights reserved. Except where otherwise noted, content on this site is licensed under a <a href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons CC-BY license</a>.<br>Many thanks to <a href="https://developer.github.com/">GitHub</a> for providing a CC-BY licenced repository for us to use and adapt.</p>
		</div>

  </div><!-- /#footer -->

</body>
</html>
